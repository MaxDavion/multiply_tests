# MULTIPLY TESTS


## ЗАДАНИЕ
Тестовым приложением является перемножитель двух целых чисел в промежутке от 0 до 100.
Веб-интерфейс расположен по адресу http://13.49.131.32/.
Прикладной компонент расположен по адресу  http://13.49.131.32:8080, принимает plain-http POST-запросы с 
двумя параметрами: first и second —  два числа, которые будут перемножены и возвращает произведение. 

```shell
#Пример запроса:
curl http://13.49.131.32:8080 -XPOST -H "Content-Length: 18" -d "first=42&second=54"

#Ответ :
2268
```

Необходимо провести автотестирование обоих компонентов.
Задачи:
* Написать автотесты для поиска значений, которые при перемножении дают неверный результат
* Проверить приложение на разных браузерах
* Проверить ошибки в интерфейсе и ошибки API
* Дополнительно:
  * Проверить максимально возможное количество одновременных подключений к серверу
  * Проверить доступность сервера на некотором непрерывном промежутке времени

Результатом выполнения задания является отчет о тестировании в формате pdf. Будет плюсом, если вы пришлете результат выполнения в виде проекта.


## ОПИСАНИЕ ВЫПОЛНЕНИЯ ЗАДАНИЯ
Используемый стек: python, py.test, requests, playwright

Тесты находятся в папке `tests`:
* `tests/api` - тесты на api метод перемножения
* `tests/ui` - тесты на интерфейс приложения и его взаимодействие с бекэндом

### API-тесты
Тесты на корректность работы сервиса и обработку ошибок содержатся в `tests/api/test_acceptance.py`

Тест на поиск значений, при которых перемножение может дать неверный результат содержится в `test_full_exhaustive_search.py`.
Этот тест выполняет полный перебор всех допустимых значений аргументов операции. Что на мой взгляд не совсем корректно,
но судя из постановки задачи, требовалось именно это. В целом проверять корректность перемножения было бы правильнее 
на уровне unit-тестов. 


### UI-тесты
Тесты на корректность работы сервиса и обработку ошибок в UI содержатся в `tests/ui/test_acceptance.py`.
Так как в приложении валидация входных данных сделана и на бекэнде и на фронте, та часть валидации которая
относится к фронту проверяется в ui-тестах.


## ЗАПУСК ТЕСТОВ

### Опции запуска тестов:
- `--BASE_URL` - позволяет передать базовую часть адреса сервиса (по-умолчанию тесты будут запускаться 
на стенде `http://13.49.131.32`, если нужно на другом стенде, то укажите его адрес через данную опцию)
- `--ALLURE` - сохранять результаты прохождении автотестов в формате allure
- `--headed` (только для ui-тестов) - без передачи этого флага тесты запускаются в headless-режиме. 
- `--browser` (только для ui-тестов) - позволяет выбрать на каком браузере запукать тесты, 
доступные значения `chromium` (по умолчанию), `firefox`, `webkit`. 



### Запуск в  Docker

1. Выполнить сборку образа
```sh
cd calculator_tests
docker build -t calculator_tests .
```

2. Запустить api-тесты в контейнере
```sh
# Запустить api-тесты с выводом результатов тестирования в консоли
docker run -it --rm calculator_tests /usr/local/bin/py.test -v -l tests/api/test_acceptance.py

# ИЛИ можно запустить api-тесты с возможность получения результатов тестирования в allure-отчете
# Для этого нужно запустить контейнер
docker run -it --rm -p 5005:5005 calculator_tests
# В нем выполнить команду запуска api-тестов
pytest -v -l tests/api/test_acceptance.py --ALLURE
# После завершения прогона запустить генерацию allure-отчета
allure serve -p 5005 logs/allure-results/

# Отчет будет доступен по http://0.0.0.0:5005/index.html
```

3. Запустить ui-тесты в контейнере
```sh
# Запустить ui-тесты с выводом результатов тестирования в консоли (на браузере chrome, 
# для запуска на других браузерах указать браузер в опции `--browser`)
docker run -it --rm calculator_tests /usr/local/bin/py.test -v -l tests/ui --browser=chromium

# ИЛИ можно запустить ui-тесты с возможность получения результатов тестирования в allure-отчете
# Для этого нужно запустить контейнер
docker run -it --rm -p 5005:5005 calculator_tests
# В нем выполнить команду запуска api-тестов 
pytest -v -l tests/ui --BASE_URL=http://13.49.131.32 --ALLURE --browser=chromium
# После завершения прогона запустить генерацию allure-отчета
allure serve -p 5005 logs/allure-results/

# Отчет будет доступен по http://0.0.0.0:5005/index.html
```

###  Локальный запуск

У Вас уже должен быть установлен Python не ниже 3.8
2. Установить зависимости проекта
```sh
cd calculator_tests
pip install --upgrade -r requirements.txt
```

2. Запустить тесты коммандой:

```sh
# Запустить api-тесты
pytest -v -l tests/api/test_acceptance.py

# Запустить ui-тесты
pytest -v -l tests/ui --browser=chromium
```

Если путь до py.test не прописан в PATH, то его следует указать в комманде запуска (узнать его можно командой "which py.test"):
```sh
#Пример:
/usr/local/bin/py.test -v -l tests
```

Для возможности генерить allure-отчет из результатов тестирования нужно:
- установить [allure-commandline](https://docs.qameta.io/allure/#_commandline)
- запускать тесты с опцией `--ALLURE`
- после их прохождения перейти в папку проекта и выполнить команду `allure serve logs/allure-results/`, отчет будет
доступен по ссылке отображаемой в коносли.

По-умолчанию тесты запускаются в headless-режиме (без GUI). Если вы хотите наблюдать как тесты отрабатывают в 
UI-браузера, то нужно запускать тесты с опцией `--headed`
```sh
pytest -v -l tests/ui --browser=chromium --headed
```



## ОШИБКИ И ЗАМЕЧАНИЯ

gurgen_1
--------
* Приложение возвращает exitcode = 35072 при больших значениях количества бросков
Воспроизводится на комманде: '/app/src/gurgen_1 999999 1 1'

gurgen_2
--------
* Приложение некорректно подсчитывает набранные очки при больших значениях количества бросков (>10000)
Пример:
- Incorrect Result = 5 for Dice = 3 4 3 6. Expected Result: 0
- Incorrect Result = 5 for Dice = 3 4. Expected Result: 0
- Incorrect Result = 15 for Dice = 4 1 3 3. Expected Result: 10

Есть подозрения, что за 4 дают 5ть очков, хотя должны давать 0

gurgen_3
--------
* Приложение некорректно подсчитывает набранные очки при больших значениях количества бросков (не учитывает что за
бонусную комбинацию 1 2 3 4 5 должны давать 150 очков а не 15)

Пример:
Incorrect Result = 15 for Dice = 1 3 2 5 4. Expected Result: 150

gurgen_4
--------
* При больших значениях количества бросков (> 10000), приложение производит больше бросков чем передано пользователем в max_dice

Пример:
Real numder of dices = 6, is greater than max_dices = 5 for Dice = {'Dices': '3 1 4 1 3 6', 'Result': '20'}

gurgen_5
--------
* При больших значениях кол-ва бросков (> 1000), на некоторых костях выпадает 7ка, хотя граней всего 6ть.


gurgen_6
--------
* При больших значениях кол-ва бросков, приложение производит меньше бросков чем передано польователем (меньше на 8мь)

Воспроизводится на комманде: '/app/src/gurgen_6 1000 1 1'
Пример: 992 вместо 1000